local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- // XÓA BẢN CŨ //
if game.CoreGui:FindFirstChild("WERTIME_V45_MOD") then game.CoreGui.WERTIME_V45_MOD:Destroy() end
local ScreenGui = Instance.new("ScreenGui", game.CoreGui); ScreenGui.Name = "WERTIME_V45_MOD"; ScreenGui.ResetOnSpawn = false

-- // BIẾN HỆ THỐNG //
local SelectedTarget, Dragging = nil, false
local OrbitDist, OrbitSpeed = 5, 20
local Smart, CamL, DragM, AntiVoid = false, false, false, false
local CamRotX, CamRotY = 0, 0
local dragTouchPos, camTouchId, lastCamPos = nil, nil, nil
local SAFE_POS = Vector3.new(0, 100, 0)
local Toggles = {} 

-- // HÀM KÉO (DRAGGABLE) //
local function MakeDraggable(gui)
    local dragging, dragInput, dragStart, startPos
    gui.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = gui.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    gui.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- // UI LOGO TRÒN VIỀN XANH (MỚI) //
local Logo = Instance.new("ImageButton", ScreenGui)
Logo.Size = UDim2.new(0, 50, 0, 50)
Logo.Position = UDim2.new(0, 50, 0, 50)
Logo.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Logo.Image = "rbxassetid://138671158580040"
Logo.ScaleType = Enum.ScaleType.Fit
Logo.AutoButtonColor = false
Instance.new("UICorner", Logo).CornerRadius = UDim.new(1, 0)

local Stroke = Instance.new("UIStroke", Logo)
Stroke.Color = Color3.fromRGB(0, 255, 150)
Stroke.Thickness = 2

local Glow = Instance.new("UIStroke", Logo)
Glow.Color = Color3.fromRGB(0, 255, 150)
Glow.Thickness = 6
Glow.Transparency = 0.7
Glow.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

MakeDraggable(Logo)

-- // MENU CHÍNH //
local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.new(0, 150, 0, 320)
Main.Position = UDim2.new(0.5, -75, 0.5, -160)
Main.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
Main.Visible = true
Main.Active = true
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)
Instance.new("UIStroke", Main).Color = Color3.fromRGB(0, 255, 150)
MakeDraggable(Main)

-- ẨN / HIỆN MENU
Logo.MouseButton1Click:Connect(function()
    Main.Visible = not Main.Visible
    Stroke.Color = Main.Visible and Color3.fromRGB(0, 255, 150) or Color3.fromRGB(0, 150, 90)
end)

-- // INPUTS //
local function CreateInput(val, y, x, cb)
    local Box = Instance.new("TextBox", Main)
    Box.Size = UDim2.new(0, 60, 0, 22); Box.Position = UDim2.new(x, 0, 0, y)
    Box.BackgroundColor3 = Color3.fromRGB(20, 20, 20); Box.Text = tostring(val); Box.TextColor3 = Color3.new(1,1,1); Box.Font = "GothamBold"; Box.TextSize = 10; Instance.new("UICorner", Box)
    Box.FocusLost:Connect(function() cb(tonumber(Box.Text) or val) end)
end
CreateInput(5, 30, 0.05, function(v) OrbitDist = v end)
CreateInput(20, 30, 0.52, function(v) OrbitSpeed = v end)

-- // CÔNG TẮC (TOGGLE) //
local function NewToggle(txt, y, cb)
    local Container = Instance.new("Frame", Main); Container.Size = UDim2.new(0.88, 0, 0, 28); Container.Position = UDim2.new(0.06, 0, 0, y); Container.BackgroundTransparency = 1
    local Label = Instance.new("TextLabel", Container); Label.Size = UDim2.new(0.6, 0, 1, 0); Label.Text = txt; Label.TextColor3 = Color3.fromRGB(200, 200, 200); Label.Font = "GothamBold"; Label.TextSize = 8; Label.TextXAlignment = "Left"; Label.BackgroundTransparency = 1
    local Switch = Instance.new("TextButton", Container); Switch.Size = UDim2.new(0, 32, 0, 16); Switch.Position = UDim2.new(1, -32, 0.5, -8); Switch.BackgroundColor3 = Color3.fromRGB(40, 40, 45); Switch.Text = ""
    Instance.new("UICorner", Switch).CornerRadius = UDim.new(1, 0)
    local Circle = Instance.new("Frame", Switch); Circle.Size = UDim2.new(0, 12, 0, 12); Circle.Position = UDim2.new(0, 2, 0.5, -6); Circle.BackgroundColor3 = Color3.fromRGB(150, 150, 150); Instance.new("UICorner", Circle).CornerRadius = UDim.new(1, 0)
    
    local st = false
    local function Upd()
        Circle:TweenPosition(st and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6), "Out", "Quart", 0.2, true)
        Circle.BackgroundColor3 = st and Color3.fromRGB(0, 255, 150) or Color3.fromRGB(150, 150, 150)
        Switch.BackgroundColor3 = st and Color3.fromRGB(30, 60, 50) or Color3.fromRGB(40, 40, 45)
    end
    Switch.MouseButton1Click:Connect(function() st = not st Upd() cb(st) end)
    table.insert(Toggles, function() st = false Upd() cb(false) end)
end

NewToggle("SOLO HACKER", 65, function(v) Smart = v end)
NewToggle("DRAG (HOLD)", 95, function(v) DragM = v end)
NewToggle("CAM LOCK", 125, function(v) CamL = v if not v then Camera.CameraType = Enum.CameraType.Custom end end)
NewToggle("ANTI VOID", 155, function(v) AntiVoid = v end)

-- // PLAYER LIST UI //
local ListF = Instance.new("Frame", ScreenGui); ListF.Size = UDim2.new(0, 160, 0, 200); ListF.Position = UDim2.new(0.5, 90, 0.5, -100); ListF.BackgroundColor3 = Color3.fromRGB(10, 10, 10); ListF.Visible = false; Instance.new("UICorner", ListF); Instance.new("UIStroke", ListF).Color = Color3.fromRGB(0, 255, 150); MakeDraggable(ListF)
local Scroll = Instance.new("ScrollingFrame", ListF); Scroll.Size = UDim2.new(0.9, 0, 0.9, 0); Scroll.Position = UDim2.new(0.05, 0, 0.05, 0); Scroll.BackgroundTransparency = 1; Scroll.ScrollBarThickness = 2; Scroll.AutomaticCanvasSize = "Y"
Instance.new("UIListLayout", Scroll).Padding = UDim.new(0, 4)

local function UpdList()
    for _,v in pairs(Scroll:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    for _,p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            local I = Instance.new("Frame", Scroll); I.Size = UDim2.new(1, 0, 0, 30); I.BackgroundColor3 = Color3.fromRGB(20, 20, 25); Instance.new("UICorner", I)
            local B = Instance.new("TextButton", I); B.Size = UDim2.new(1,0,1,0); B.BackgroundTransparency = 1; B.Text = p.DisplayName; B.TextColor3 = Color3.new(1,1,1); B.Font = "GothamBold"; B.TextSize = 9
            B.MouseButton1Click:Connect(function() SelectedTarget = p; ListF.Visible = false end)
        end
    end
end

-- // NÚT BẤM //
local function NewBtn(txt, y, cb, col)
    local b = Instance.new("TextButton", Main); b.Size = UDim2.new(0.88, 0, 0, 30); b.Position = UDim2.new(0.06, 0, 0, y); b.BackgroundColor3 = col or Color3.fromRGB(25, 25, 30); b.Text = txt; b.TextColor3 = Color3.new(1,1,1); b.Font = "GothamBold"; b.TextSize = 9; Instance.new("UICorner", b)
    b.MouseButton1Click:Connect(cb)
end

NewBtn("SELECT TARGET", 195, function() ListF.Visible = not ListF.Visible UpdList() end)
NewBtn("STOP ALL", 235, function() SelectedTarget = nil; Camera.CameraType = Enum.CameraType.Custom; for _, f in pairs(Toggles) do f() end end, Color3.fromRGB(120, 20, 20))

-- // LOGIC HEARTBEAT //
RunService.Heartbeat:Connect(function()
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    if AntiVoid then
        local ray = Ray.new(hrp.Position, Vector3.new(0, -10^10, 0))
        if not workspace:FindPartOnRay(ray, LocalPlayer.Character) then hrp.Velocity = Vector3.zero; hrp.CFrame = CFrame.new(SAFE_POS) end
    end

    if SelectedTarget and SelectedTarget.Character and SelectedTarget.Character:FindFirstChild("HumanoidRootPart") then
        local tP = SelectedTarget.Character.HumanoidRootPart
        local tPos = tP.Position
        if DragM and Dragging and dragTouchPos then
            local r = Camera:ViewportPointToRay(dragTouchPos.X, dragTouchPos.Y)
            tPos = r.Origin + r.Direction * 25
            tP.CFrame = tP.CFrame:Lerp(CFrame.new(tPos), 0.3); tP.AssemblyLinearVelocity = Vector3.zero
        end
        local t = tick() * OrbitSpeed
        local o = Vector3.new(math.cos(t)*OrbitDist, (Smart and math.sin(tick()*15)*3 or 0), math.sin(t)*OrbitDist)
        hrp.CFrame = CFrame.lookAt(tPos + o, tPos); hrp.AssemblyLinearVelocity = Vector3.zero
        if CamL then
            Camera.CameraType = Enum.CameraType.Scriptable
            Camera.CFrame = CFrame.new(tPos) * CFrame.Angles(0, CamRotX, 0) * CFrame.Angles(CamRotY, 0, 0) * CFrame.new(0, 2, 12)
        end
    end
end)

-- // INPUT //
UserInputService.InputBegan:Connect(function(i, g)
    if g then return end
    if i.UserInputType == Enum.UserInputType.Touch or i.UserInputType == Enum.UserInputType.MouseButton1 then
        Dragging = true; dragTouchPos = i.Position
        if CamL then camTouchId = i; lastCamPos = i.Position end
    end
end)
UserInputService.InputChanged:Connect(function(i)
    if Dragging then dragTouchPos = i.Position end
    if CamL and i == camTouchId then
        local d = i.Position - lastCamPos
        CamRotX, CamRotY = CamRotX - d.X * 0.008, math.clamp(CamRotY - d.Y * 0.008, -1.3, 1.3)
        lastCamPos = i.Position
    end
end)
UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.Touch or i.UserInputType == Enum.UserInputType.MouseButton1 then
        Dragging = false; if i == camTouchId then camTouchId = nil end
    end
end)
